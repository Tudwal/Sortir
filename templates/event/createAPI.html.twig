{% extends 'base.html.twig' %}

{% block title %}Nouvelle sortie
{% endblock %}

{% block body %}

	<div class="col-12 my-3">

		{{form_start(formulaire)}}

		<div class="col-2">
			{{form_errors(formulaire.name)}}
			{{form_errors(formulaire.startDateTime)}}
			{{form_errors(formulaire.endRegisterDate)}}
			{{form_errors(formulaire.duration)}}
			{{form_errors(formulaire.nbParticipantMax)}}
			{{form_errors(formulaire.details)}}
		</div>
		<fieldset>
			<legend>Créer une sortie</legend>

			<div class="d-flex">

				<div class="col-6">

					<div class="form-group row">

						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.name)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.name)}}
						</div>
					</div>
					<div class="form-group row">

						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.startDateTime)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.startDateTime)}}
						</div>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.endRegisterDate)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.endRegisterDate)}}
						</div>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.nbParticipantMax)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.nbParticipantMax)}}
						</div>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.duration)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.duration)}}
						</div>
					</div>


					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.details)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.details)}}
						</div>
					</div>

				</div>

				<div class="col-6">
					<div class="form-group row">

						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.campus)}}
						</label>
						<div class="col-6">
							{{form_widget(formulaire.campus)}}
						</div>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							Ville
						</label>
						<div class="col-6">
							{{form_widget(formulaire.city)}}
						</div>
					</div>


					<div class="form-group row">

						<label for="select" class="col-4 col-form-label">
							{{form_label(formulaire.location)}}
						</label>
						<div class="col-6" name="location" id="location">
							{{form_widget(formulaire.location)}}
						</div>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							Rue
						</label>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							Code postal
						</label>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							Latitude
						</label>
					</div>
					<div class="form-group row">
						<label for="select" class="col-4 col-form-label">
							Longitude
						</label>
					</div>
				</div>
			</div>
		</fieldset>
		<div class="my-4">
			<button class="btn btn-primary" type="submit">Créer la sortie
				<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary"></span>
			</button>
			<button class="btn btn-success" type="submit">Publier la sortie
				<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary"></span>
			</button>
			<a href="{{ path('home')}}" class="btn btn-warning">
				Annuler
				<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary"></span>
			</a>
		</div>
		{{form_end(formulaire)}}
	</div>

	{# 
						Ville :
						<select
							name="city" id="city">
						</select>
						<br>
						Lieu :
						<select name="loc" id="loc">
					
						</select> #}


<script>

   let cities = {};
    let url = 'http://localhost/Sortir/public/home/api/';
    fetch(url)
    .then(res => res.json())
    .then(data => {cities = data
        console.log(data);
    afficherCity();
    afficherLocation(cities[0].id);
    
    });
    
    // alimenter select city
    function afficherCity() { 
        let baliseCity = document.querySelector('#event_type_api_city');
    
        for (let c of cities) {
            let option = document.createElement('option'); // <option></option>
            option.innerHTML = c.name; // <option>Rennes</option>
            option.setAttribute('value', c.id); // <option value="1">Rennes</option>
            baliseCity.appendChild(option);
        }
    }
    
    // alimenter select Location
    function afficherLocation(cityId) {
        let baliseLocation = document.querySelector('#event_type_api_location');
        // vider la balise select du Location
        baliseLocation.innerHTML = '';

        // rechercher ts les Locations correspondant à la city
        for (let c of cities) {
            console.log('je suis dans le premier IF')

            if (c.id == cityId) {
                for (let l of c.locations) {
                    console.log('je suis dans le deuxième IF')
                    let option = document.createElement('option'); // <option></option>
                    option.innerHTML = l.name; // <option>Mairie</option>
                    console.log(c.name)
                    console.log(l.name)
                    option.setAttribute('value', l.id); // <option value="1">Mairie</option>
                    console.log(option)
                    baliseLocation.appendChild(option);
                    console.log(baliseLocation)
                }
            }
        }
    }

    // condition de depart
    // afficherLocation(data.cities[0].id);
    document.querySelector('#event_type_api_city').onchange = function () {
        let id = document.querySelector('#event_type_api_city').value;
        console.log("Je suis tout en bas")
        console.log(id);
        afficherLocation(id);
    }
	
</script>
{% endblock %}
